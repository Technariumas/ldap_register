#!/bin/bash
sudo rm ldapregister_*.deb
sudo rm -rf deb
sudo rm -rf rel/ldapregister
set -e
rebar get-deps compile generate
mkdir -p deb/root/opt/ldapregister/ssl
mv rel/ldapregister/* deb/root/opt/ldapregister
cat << EOF > deb/root/opt/ldapregister/ldapregister.config
"%%% You MUST put proper configuration paramethers below
[{ldapregister,
    [{mailFrom,"Slaptažodžių dievas <address@domain.lt>"},
    {relay,"SMTP hostname_or_ip_address"},
     {relay_user,"SMTP_username"},
     {relay_pass,"SMTP_password"},
     {tls_port,8081}, % The port number to listen to 
     {tls_cacertfile,"/opt/ldapregister/ssl/cacert.crt"}, % Full path where your CA cert 
     {tls_certfile,"/opt/ldapregister/ssl/cert.crt"}, % Full path where your cert is 
     {tls_keyfile,"/opt/ldapregister/ssl/keyfile.key"}, % Full path where yout key is
     {shasalt,"sdfwrwqtrwqe"} % Salt used to generate links to pages generated for every member
     ]
}]
EOF
sudo chown -R root:root deb/root
fpm -s dir -t deb \
  -n "ldapregister" \
  --config-files /opt/ldapregister/ldapregister.config \
  -a all \
  -v 0.0.1 \
  -m "Ricardas Pocius <cirka@cirka.lt>" \
  --description "Website for registration to Technarium LDAP" \
  -C ./deb/root opt
sudo rm -rf deb




